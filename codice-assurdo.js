const nomi_json = {
    "1": "",
    "2": "Isola di San Salvador",
    "3": "Santa Maria de la Concepciòn",
    "4": "Fernandina",
    "5": "Baia Di Bariay",
    "6": "Baia di Baracoa",
    "7": "Hispaniola",
    "8": "Bahía de Los Mosquitos",
    "9": "Tortuga",
    "10": "Capo Samanà",
    "11": "             ",
    "12": "Gomera",
    "13": "Dominica 1",
    "14": "Antille",
    "15": "Santa Cruz",
    "16": "Porto Rico",
    "17": "Baia Samanà",
    "18": "Puerto Grande",
    "19": "Baia Guantanamo",
    "20": "Giamaica",
    "21": "",
    "22": "Canarie",
    "23": "Dominica 2",
    "24": "Capo Verde",
    "25": "Golfo di Paria",
    "26": "Delta dell’Orinoco",
    "27": "Santo Domingo",
    "28": "Cadice",
    "29": "Rio delle Amazzoni",
    "30": "Cuba",
    "31": "",
    "32": "Gran Canaria",
    "33": "Martinica",
    "34": "Honduras",
    "35": "Nicaragua",
    "36": "Costa Rica",
    "37": "Panama",
    "38": "isole Cayman",
    "39": "Navassa",
    "40": "Santo Domingo"
}

const tasse_json = {
    "1": 50,
    "2": 0,
    "3": 50,
    "4": 200,
    "5": 200,
    "6": 100,
    "7": 0,
    "8": 100,
    "9": 120,
    "10": 0,
    "11": 140,
    "12": 160,
    "13": 140,
    "14": 160,
    "15": 200,
    "16": 180,
    "17": 180,
    "18": 0,
    "19": 180,
    "20": 200,
    "21": 0,
    "22": 220,
    "23": 0,
    "24": 220,
    "25": 200,
    "26": 200,
    "27": 260,
    "28": 260,
    "29": 120,
    "30": 280,
    "31": 0,
    "32": 300,
    "33": 300,
    "34": 0,
    "35": 320,
    "36": 200,
    "37": 0,
    "38": 360,
    "39": 75,
    "40": 400
}

const desc_json = {
    "1": "Punto Di Partenza.",
    "2": "12 Ottobre 1492 Prima tappa del primo fra 4 dei viaggi che Colombo condusse verso il “Nuovo Mondo”. San Salvador una delle isole, presenti nella baia di Fernandez. Colombo e la sua ciurma furono accolti con grande cortesia e condiscendenza dai Taino, i nativi di etnia Arawak, abitanti dell'isola.",
    "3": "Ripreso il mare, con sei indigeni che svolsero attività di interpreti e di guide, la sua spedizione esplorò prima alcune isole prive di fiumi, la prima delle quali fu Santa Maria De La Concepción",
    "4": "Seconda delle isole prive di fiumi esplorate grazie all’aiuto di due indigeni",
    "5": "La sera del 27 ottobre 1492 le caravelle di Colombo arrivano alla fonda della baia di Bariay a Cuba, nell'attuale provincia di Holguín.",
    "6": "Cercando l'oro Pinzon (comandante della Pinta) ricevette informazioni su una fantomatica isola chiamata Babeque e decise, dopo qualche tentativo con Colombo, di partire da solo con la Pinta; per quasi due mesi scomparve, mentre Colombo giunse nella baia di Baracoa.",
    "7": "Colombo esplorò la costa settentrionale di Haiti, raggiunta il 5 dicembre 1492, e la chiamò Hispaniola; approdò la sera del 6 dicembre chiamando il luogo, Puerto San Nicola.",
    "8": "Cercò l'oro giungendo in quella che chiamò Bahia de los Mosquitos, nome che sopravvisse nei secoli.",
    "9": "Approdò su un isola a forma di tartaruga che il navigatore chiamò poi Tortuga",
    "10": "Prima del ritorno decisero di trarre in secco le due caravelle, a Capo Samanà, per opere di manutenzione.",
    "11": 'Questa è la prigione.',
    "12": "Approdarono a Gomera come nel primo viaggio e ne ripartirono il 13 ottobre 1493.",
    "13": "Il 3 novembre 1493 la flotta raggiunse Dominica, chiamata in tal modo perché la raggiunse nel giorno di domenica.",
    "14": "Veleggiò tra le piccole e le grandi Antille",
    "15": "Giunse poi all’isola di Santa Cruz, dove perse uno dei suoi uomini, il primo morto nei viaggi.",
    "16": "ll 19 novembre 1493 arrivarono a Porto Rico",
    "17": "Il 23 novembre 1493 giunsero nella baia di Samanà.",
    "18": "Il 30 aprile 1494 giunto a Cuba, raggiunse Puerto Grande",
    "19": "In  seguito a Puerto Grande, Colombo raggiunse la baia di Guantánamo",
    "20": "Il 3 maggio 1494, Cabo de Cruz e pochi giorni dopo arrivò in Giamaica.",
    "21": "",
    "22": "La flotta, partita il 30 maggio 1498 per il Terzo viaggio si diresse verso Le Gran Canarie ",
    "23": " Sei navi si divisero, tre proseguirono con Colombo, altre tre verso le rotte ormai consolidate verso Dominica.",
    "24": " L'ammiraglio proseguì con la flotta ridotta verso le isole di Capo Verde da dove raggiunse Trinidad, il 31 luglio 1498.",
    "25": "Nell'agosto dell’anno 1498 Colombo esplorò il Golfo di Paria",
    "26": " Giunse sul delta dell'Orinoco, nell'attuale Venezuela, non accorgendosi che si trattava di un continente e non di piccole isole.",
    "27": "Giunse ad Hispaniola l'11 agosto del 1498, cercò la nuova città fondata dal fratello Bartolomeo Colombo, Santo Domingo.",
    "28": "Nel mese di ottobre del 1500, sulla Gorda, una caravella giunsero a Cadice.",
    "29": " Vi furono altre esplorazioni e scoperte, fra le quali vi è quella del Rio delle Amazzoni ",
    "30": "Tutta la zona limitrofa al Rio delle Amazzoni venne denominata Cuba",
    "31": "",
    "32": "Colombo intraprese un quarto viaggio, accompagnato dal fratello Bartolomeo e dal figlio tredicenne Fernando. Le quattro navi concesse, di tre di esse conosciamo il nome: Santiago, Gallega, pilotata da Pedro de Terreros, e Vizcaina, comandata da Bartolomeo Fieschi, salparono da Cadice il 9 maggio 1502. Evitarono Gomera e si rifornirono nell'isola di Gran Canaria il 20 maggio 1502.",
    "33": "Ripresa la traversata, impiegarono 20 giorni per giungere a Martinica.",
    "34": "Tra il luglio e l'ottobre del 1502 Colombo costeggiò l'Honduras, il Nicaragua e la Costa Rica",
    "35": "Tra il luglio e l'ottobre del 1502 Colombo costeggiò l'Honduras, il Nicaragua e la Costa Rica",
    "36": "Tra il luglio e l'ottobre del 1502 Colombo costeggiò l'Honduras, il Nicaragua e la Costa Rica",
    "37": "Fra piogge continue di giorno, in 28 giorni viaggiarono per 170 miglia. Il 5 ottobre 1502, giunse in quello che gli indigeni chiamavano Ciguara, dove sarebbe stato scavato il canale di Panama, e saputo che a poche miglia vi era un altro mare abbandonò l'idea di raggiungerlo. Il 16 ottobre 1502 giunse a Panama, dove si fermò per l'inverno.",
    "38": "Il 16 aprile 1503 Colombo scoprì le Isole Cayman e le battezzò Las Tortugas, grazie alle numerose tartarughe marine presenti.",
    "39": " Dopo tre giorni di navigazione giunsero a Navassa",
    "40": " A settembre del 1503 furono a Santo Domingo e con questa ultima tappa si concluse l’ultimo dei 4 viaggi di uno dei più grandi esploratori della storia."
}

const caselle_imprevisti = [3, 18, 34];

function imposta_dadi() {
    // waluigi
    const a = 1 + Math.floor(Math.random() * 6);
    const b = 1 + Math.floor(Math.random() * 6);
    document.getElementById('dado-1').innerHTML = a.toString();
    document.getElementById('dado-2').innerHTML = b.toString();
    document.getElementById('somma').innerHTML = `Somma = ${a + b}`;

    let tira_di_nuovo = a === b;

    if (tira_di_nuovo) {
        alert('Hai tirado due dadi con lo stesso valore, potrai tirarne un\'altro nello stesso turno!');
    }

    notifica_movimento(a + b);
    muovi_pedina(a + b);
    colora_casella(NaN, true);

    if (!tira_di_nuovo) {
        incrementa_turno();
        togli_soldati_turno();
    }
}

togli_soldati_turno = () => {
    let el = document.getElementById('soldati');
    let num = parseInt(el.innerHTML);
    num -= 200;
    el.innerHTML = num;
}

incrementa_turno = () => {
    let element = document.getElementById('turno');
    let n = element.innerHTML;
    let nn = parseInt(n);
    nn += 1;
    element.innerHTML = nn.toString();
}

traduci_json = () => {
    for (let i = 1; i <= 40; i++) {
        let name = `p-${i}`;
        let el = document.getElementById(name);
        if (el != null) {
            el.innerHTML = nomi_json[i.toString()]
        }
    }
}

function reset_gioco() {
    document.getElementById('turno').innerHTML = '1';
    localStorage.setItem('casella', '1');
    location.reload();
}

window.onload = () => {
    traduci_json();
    if (localStorage.getItem('casella') === null) {
        window.localStorage.removeItem('casella');
        window.localStorage.setItem('casella', '1');
        colora_casella(1, true);
    }
}

fotti_soldati = (pos) => {
    let cash = tasse_json[pos.toString()];
    if (cash !== 0) {
        let soldati = document.getElementById('soldati');
        let num = parseInt(soldati.innerHTML);
        if (num - cash <= 0) {
            alert('Hai finito i soldati, hai perso!');
            soldati.innerHTML = '0';
        } else {
            soldati.innerHTML = (num - cash).toString();
        }
    }
}

function info_casella(id) {
    let msg = desc_json[id.toString()];
    if (msg == "") {
        // mancante
    } else {
        alert(msg);
    }
}

function colora_casella(num, abs) {
    for (let i = 1; i <= 40; i++) {
        document.getElementById(i.toString()).style.background = '#fafaf8';
    }

    if (!abs) {
        let space = document.getElementById(num);
        space.style.background = '#fc3917';
    } else {
        let space = document.getElementById(localStorage.getItem('casella'));
        space.style.background = '#fc3917';
    }

}

function imprevisti() {
    if (caselle_imprevisti.includes(parseInt(localStorage.getItem('casella')))) {
        let rand = Math.random() < 0.50;
        let soldati;
        if (rand) {
            soldati = +300;
            alert('Hai vinto 300 SOLDATI con un imprevisto!');
        } else {
            soltati = -300;
            alert('Hai perso 300 SOLDATI con un imprevisto!');
        }
        let el = document.getElementById('soldati');
        let num = parseInt(el.innerHTML);
        num = num + soldati;
        el.innerHTML = num;
    } else { }
}

function muovi_pedina(pos) {
    let casella = parseInt(window.localStorage.getItem('casella'));
    if (casella + pos > 40) {
        window.localStorage.setItem(`casella`, ((casella + pos) - 40).toString());
    } else {
        window.localStorage.setItem(`casella`, casella + pos);
    }

    alert(`La tua posizione e\': ${window.localStorage.getItem('casella')}`);

    fotti_soldati(parseInt(window.localStorage.getItem('casella')))
}

function notifica_movimento(pos) {
    alert(`Ti sei mosso di ${pos} caselle!`);
}
